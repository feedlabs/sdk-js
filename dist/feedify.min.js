!function(t){"use strict";var e={feedId:"",outputContainerId:"defaultContainerId",defaultElementLayout:"",defaultElementCount:0,defaultElementShowTime:300},n=function(t,n){this.options=this._extend(e,t),this.stylerFunction=n||this._stylerFunction,this.objectList={},this.defaultEntryIds=[],this.outputContainer=document.getElementById(this.options.outputContainerId),this._addDefaultEntries(),this.initFeedPage(),this._bindToStream()};n.prototype._addDefaultEntries=function(){for(var t=1;t<=this.options.defaultElementCount;t++){var e=this._uniqueId(),n=document.createElement("div");n.id=e,n.innerHTML=this.options.defaultElementLayout,this.outputContainer.appendChild(n),this.defaultEntryIds.push(e)}},n.prototype._removeDefaultEntries=function(){this.defaultEntryIds.forEach(function(t){var e=document.getElementById(t);e&&e.parentNode.removeChild(e)})},n.prototype.initFeedPage=function(){var t=this;setTimeout(function(){t._loadFeedPage()},this.options.defaultElementShowTime)},n.prototype._loadFeedPage=function(){var t=this,e="http://www.feedify.dev:10111/v1/feed/"+t.options.feedId+"/entry";t._load(e,function(e){var n=JSON.parse(e.responseText);for(var o in n)if(n.hasOwnProperty(o)){var i=n[o];t.add(i)}t._removeDefaultEntries()})},n.prototype._bindToStream=function(){var t=this,e=this.getSocketRedisClient();e.subscribe("iO5wshd5fFE5YXxJ/hfyKQ==:17",(new Date).getTime(),{sessionId:"55e10ffb7ba3ca6d8fd39f25cd64253d"},function(e,n){t.processData(n.data)})},n.prototype._load=function(t,e){function n(){o.readyState<4||200===o.status&&4===o.readyState&&e(o)}var o;if("undefined"!=typeof XMLHttpRequest)o=new XMLHttpRequest;else for(var i=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],a=0,d=i.length;d>a;a++)try{o=new ActiveXObject(i[a]);break}catch(r){}o.onreadystatechange=n,o.open("GET",t,!0),o.send("")},n.prototype._uniqueId=function(){return"_"+Math.random().toString(36).substr(2,9)},n.prototype._extend=function(t,e){var n,o={};for(n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);for(n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);return o},n.prototype.processData=function(t){switch(t.Action){case"add":this.add(t);break;case"remove":this.remove(t);break;case"update":this.update(t);break;default:console.log("Unknown action `"+t.Action+"`")}},n.prototype.add=function(t){var e=t.Id;this.objectList[e]=e;var n=document.createElement("div");n.id=e,n.innerHTML=this.stylerFunction(t.Data),this.outputContainer.insertBefore(n,this.outputContainer.firstChild)},n.prototype.update=function(t){var e=document.getElementById(t.Id);e.innerHTML=this.stylerFunction(t.Data)},n.prototype.remove=function(t){var e=document.getElementById(t.Id);e.remove(),delete this.objectList[t.Id]},n.prototype.getSocketRedisClient=function(){return"undefined"==typeof window.feedify&&(window.feedify={}),"undefined"==typeof window.feedify.socketRedisClient&&(window.feedify.socketRedisClient=this.createSocketRedisClient("http://www.feedify.dev:8090")),window.feedify.socketRedisClient},n.prototype.createSocketRedisClient=function(t){function e(t){var e=this;d(100,5e3,function(d,r){n=new SockJS(t),n.onopen=function(){r();for(var t in o)o.hasOwnProperty(t)&&a(t,i);i=null,e.onopen.call(e)},n.onmessage=function(t){var n=JSON.parse(t.data);o[n.channel]&&o[n.channel].callback.call(e,n.event,n.data)},n.onclose=function(){i=(new Date).getTime(),d(),e.onclose.call(e)}}),window.addEventListener&&window.addEventListener("keydown",function(t){27===t.keyCode&&t.preventDefault()})}var n,o={},i=null;e.prototype.subscribe=function(t,e,i,d){if(o[t])throw"Channel `"+t+"` is already subscribed";o[t]={event:{channel:t,start:e,data:i},callback:d},n.readyState===SockJS.OPEN&&a(t)},e.prototype.unsubscribe=function(t){o[t]&&delete o[t],n.readyState===SockJS.OPEN&&n.send(JSON.stringify({event:"unsubscribe",data:{channel:t}}))},e.prototype.send=function(t){n.send(JSON.stringify({event:"message",data:{data:t}}))},e.prototype.publish=function(t,e,o){n.send(JSON.stringify({event:"publish",data:{channel:t,event:e,data:o}}))},e.prototype.onopen=function(){},e.prototype.onclose=function(){};var a=function(t,e){var i=o[t].event;e||(e=i.start||(new Date).getTime()),n.send(JSON.stringify({event:"subscribe",data:{channel:i.channel,data:i.data,start:e}}))},d=function(t,e,n){var o,i=t,a=function(){i=t,window.clearTimeout(o)},d=function(){var r=this;window.clearTimeout(o),o=window.setTimeout(function(){n.call(r,d,a),i=Math.min(Math.max(t,2*i),e)},i)};n.call(this,d,a)};return new e(t)},n.prototype._stylerFunction=function(t){return t},"function"==typeof define&&define.amd?define(function(){return n}):t.FeedPlugin=n}("undefined"==typeof window?this:window);