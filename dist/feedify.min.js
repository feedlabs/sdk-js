!function(t){var e={feedId:"",outputContainerId:"defaultContainerId",defaultElementLayout:"",defaultElementCount:0,defaultElementShowTime:300},n=function(t,n){return this.options=this._extend(e,t),this.stylerFunction=n||this._stylerFunction,this.objectList={},this.defaultEntryIds=[],this.outputContainer=document.getElementById(this.options.outputContainerId),this._addDefaultEntries(),this.initFeedPage(),this._bindToStream(),this};n.prototype._addDefaultEntries=function(){for(var t=1;t<=this.options.defaultElementCount;t++){var e=this._uniqueId(),n=document.createElement("div");n.id=e,n.innerHTML=this.options.defaultElementLayout,this.outputContainer.appendChild(n),this.defaultEntryIds.push(e)}},n.prototype._removeDefaultEntries=function(){this.defaultEntryIds.forEach(function(t){var e=document.getElementById(t);e&&e.parentNode.removeChild(e)})},n.prototype.initFeedPage=function(){var t=this;setTimeout(function(){t._loadFeedPage()},this.options.defaultElementShowTime)},n.prototype._loadFeedPage=function(){var t=this,e="http://www.feedify.dev:10111/v1/feed/"+t.options.feedId+"/entry";t._load(e,function(e){var n=JSON.parse(e.responseText);for(var o in n)if(n.hasOwnProperty(o)){var i=n[o];t.add(i)}t._removeDefaultEntries()})},n.prototype._bindToStream=function(){var t=this,e=this.getSocketRedisClient();e.subscribe("iO5wshd5fFE5YXxJ/hfyKQ==:17",(new Date).getTime(),{sessionId:"55e10ffb7ba3ca6d8fd39f25cd64253d"},function(e,n){t.processData(n.data)})},n.prototype._load=function(t,e){function n(){o.readyState<4||200===o.status&&4===o.readyState&&e(o)}var o;if("undefined"!=typeof XMLHttpRequest)o=new XMLHttpRequest;else for(var i=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],a=0,r=i.length;r>a;a++)try{o=new ActiveXObject(i[a]);break}catch(d){}o.onreadystatechange=n,o.open("GET",t,!0),o.send("")},n.prototype._uniqueId=function(){return"_"+Math.random().toString(36).substr(2,9)},n.prototype._extend=function(t,e){var n,o={};for(n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);for(n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);return o},n.prototype.processData=function(t){switch(t.Action){case"add":this.add(t);break;case"remove":this.remove(t);break;case"update":this.update(t);break;default:console.log("Unknown action `"+t.Action+"`")}},n.prototype.add=function(t){var e=t.Id;this.objectList[e]=e;var n=document.createElement("div");n.id=e,n.innerHTML=this.stylerFunction(t.Data),this.outputContainer.insertBefore(n,this.outputContainer.firstChild)},n.prototype.update=function(t){var e=document.getElementById(t.Id);e.innerHTML=this.stylerFunction(t.Data)},n.prototype.remove=function(t){var e=document.getElementById(t.Id);e.remove(),delete this.objectList[t.Id]},n.prototype.getSocketRedisClient=function(){return"undefined"==typeof t.feedify&&(t.feedify={}),"undefined"==typeof t.feedify.socketRedisClient&&(t.feedify.socketRedisClient=this.createSocketRedisClient("http://www.feedify.dev:8090")),t.feedify.socketRedisClient},n.prototype.createSocketRedisClient=function(e){function n(e){var n=this;d(100,5e3,function(t,d){o=new SockJS(e),o.onopen=function(){d();for(var t in i)i.hasOwnProperty(t)&&r(t,a);a=null,n.onopen.call(n)},o.onmessage=function(t){var e=JSON.parse(t.data);i[e.channel]&&i[e.channel].callback.call(n,e.event,e.data)},o.onclose=function(){a=(new Date).getTime(),t(),n.onclose.call(n)}}),t.addEventListener&&t.addEventListener("keydown",function(t){27===t.keyCode&&t.preventDefault()})}var o,i={},a=null;n.prototype.subscribe=function(t,e,n,a){if(i[t])throw"Channel `"+t+"` is already subscribed";i[t]={event:{channel:t,start:e,data:n},callback:a},o.readyState===SockJS.OPEN&&r(t)},n.prototype.unsubscribe=function(t){i[t]&&delete i[t],o.readyState===SockJS.OPEN&&o.send(JSON.stringify({event:"unsubscribe",data:{channel:t}}))},n.prototype.send=function(t){o.send(JSON.stringify({event:"message",data:{data:t}}))},n.prototype.publish=function(t,e,n){o.send(JSON.stringify({event:"publish",data:{channel:t,event:e,data:n}}))},n.prototype.onopen=function(){},n.prototype.onclose=function(){};var r=function(t,e){var n=i[t].event;e||(e=n.start||(new Date).getTime()),o.send(JSON.stringify({event:"subscribe",data:{channel:n.channel,data:n.data,start:e}}))},d=function(e,n,o){var i,a=e,r=function(){a=e,t.clearTimeout(i)},d=function(){var s=this;t.clearTimeout(i),i=t.setTimeout(function(){o.call(s,d,r),a=Math.min(Math.max(e,2*a),n)},a)};o.call(this,d,r)};return new n(e)},n.prototype._stylerFunction=function(t){return t},"function"==typeof define?define(function(){return n}):t.FeedPlugin=n}(window);